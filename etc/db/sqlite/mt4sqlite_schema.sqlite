/*
Created     16.01.2017
Modified    17.01.2017
Project     MyFX
Model       MetaTrader SQLite DB
Author      Peter Walther
Version     0.1
Database    SQLite3
*/


.open --new "mt4sqlite.db"


-- empty the database
pragma writable_schema = 1;
delete from sqlite_master;
pragma writable_schema = 0;
vacuum;
pragma foreign_keys = on;


-- TickModel enumeration
create table TickModels (
   Type text[enum] primary key not null
);
insert into TickModels (Type) values
   ('EveryTick'    ),
   ('ControlPoints'),
   ('BarOpen'      );


-- TradeDirection enumeration
create table TradeDirections (
   Type text[enum] primary key not null
);
insert into TradeDirections (Type) values
   ('Long' ),
   ('Short'),
   ('Both' );


-- Test
create table Test (
   Id              integer       not null,
   Created         text          not null default (datetime('now', 'localtime')),
   Strategy        text(260)     not null,
   ReportingId     integer       not null,
   ReportingSymbol text(11)      not null,
   Symbol          text(11)      not null,
   Timeframe       integer       not null,
   StartTime       text          not null,                                 -- FXT
   EndTime         text          not null,                                 -- FXT
   TickModel       text[enum]    not null references TickModels(Type),
   Spread          float(2,1)    not null,                                 -- in pips
   Bars            integer       not null,                                 -- number of tested bars
   Ticks           integer       not null,                                 -- number of tested ticks
   TradeDirections text[enum]    not null references TradeDirections(Type),
   VisualMode      integer[bool] not null,
   Duration        integer       not null,                                 -- test duration in milliseconds
   primary key (Id)
);
create unique index u_reportingsymbol      on Test(ReportingSymbol);
create unique index u_strategy_reportingid on Test(Strategy, ReportingId);


-- insert some data
insert into Test (strategy, reportingid, reportingsymbol, symbol, timeframe, starttime, endtime, tickmodel, spread, bars, ticks, tradedirections, visualmode, duration) values
   ('MA example', 1, 'MAex.001', 'EURUSD',  5, datetime('now', 'localtime'), datetime('now', 'localtime'), 'BarOpen', 0.2, 1000, 1001, 'Both', 0, 1234);

/*
   OrderHistory* orders;   // array of orders
*/



